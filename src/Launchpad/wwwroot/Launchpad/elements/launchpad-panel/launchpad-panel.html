<link rel="import" href="/sys/polymer/polymer.html">
<link rel="import" href="/sys/imported-template/imported-template.html">
<link rel="import" href="/sys/juicy-tile-table/juicy-tile-table.html">

<dom-module id="launchpad-panel">
    <template>
        <style>
            :host{
                display: block;
                min-height: 1em;
            }
            .launchpad-tile a {
                text-align: center;
                min-width: 80px;
                display: block;
                text-align: center;
            }

            .launchpad-tile .launchpad-icon {
                padding: 8px;
                border-radius: 8px;
                display: flex;
                justify-content: center;
                align-items: center;
                min-width: 64px;
                min-height: 64px;
            }

            .launchpad-tile .launchpad-icon img,
            .launchpad-tile .launchpad-icon svg {
                width: 64px;
                height: 64px;
            }

            .launchpad-tile:hover .launchpad-icon {
                box-shadow: inset 0px 0px 10px rgba(138, 152, 176,0.8);
            }

            .launchpad-tile > a,
            .launchpad-tile:hover a {
                display: block;
                color: inherit;
                text-decoration: none;
            }

            .launchpad-tile .launchpad-label {
                display: block;
                text-align: center;
                margin: 2px;
                height: 14px;
                font-size: 13px;
                font-family: inherit;
                font-weight: normal;
                line-height: 1.1;
            }
        </style>

        <juicy-tile-table defaulttilesetup='{ "height": 98, "width": 80}' gutter="10" refreshonmutation name="/Launchpad" setup='[[cloneJSON(layout)]]'>
            <template is="dom-repeat" items="{{appsArray}}">
                <div class="launchpad-tile">
                    <a href="{{item.url}}">
                        <div class="launchpad-icon">
                            <template is="imported-template" content$="{{item.html}}"></template>
                        </div>
                        <span class="launchpad-label" title="{{item.description}}">{{item.name}}</span>
                    </a>
                </div>
            </template>
        </juicy-tile-table>
    </template>

    <script>
        Polymer({
            is: "launchpad-panel",
            properties: {
                apps: {
                    type: Object,
                    value: null,
                    observer: "appsChanged"
                },
                appsArray: {
                    type: Array,
                    value: function(){return [];}
                },
                layout: {
                  type: Object,
                  value: null
                }
            },
            cloneJSON: function(obj){
              if(obj && typeof obj === 'object'){
                return JSON.parse(JSON.stringify(obj));
              } else {
                return JSON.parse(obj);
              }
            },
            // layoutChanged: function(newVal){
            //   newVal && this.shadowRoot.getElementByTagName('juicy-tile-table').setup = JSON.parse(JSON.stringify(newVal));
            // },
            appsChanged: function (newVal, oldVal) {
                var array = [];

                for (var i in newVal) {
                    if (!Object.prototype.hasOwnProperty.call(newVal, i)) {
                        return;
                    }

                    var app = newVal[i];

                    if (app.name) {
                        var a = JSON.parse(JSON.stringify(app));

                        a.url = a.url || "/" + a.name.toLowerCase();
                        array.push(a);
                    }
                }

                array.sort(function (a, b) {
                    var at = typeof a.sortNumber == "undefined" ? a.name : a.sortNumber;
                    var bt = typeof b.sortNumber == "undefined" ? b.name : b.sortNumber;

                    at = at.toString();
                    bt = bt.toString();

                    if (at < bt) {
                        return -1;
                    } else if (at > bt) {
                        return 1;
                    }

                    return 0;
                });

                this.set("appsArray", array);
            }
        });
    </script>
</dom-module>
